# variable for ../ and ../../ directories
cmake_path(GET CMAKE_CURRENT_SOURCE_DIR PARENT_PATH testing_dir)
cmake_path(GET testing_dir PARENT_PATH main_dir)

get_filename_component(TEST_NAME ${CMAKE_CURRENT_SOURCE_DIR} NAME)
# linking gtest
add_library(GTest::GTest INTERFACE IMPORTED)
target_link_libraries(GTest::GTest INTERFACE gtest_main)

# executable for the code generated by the emit-cpp.rkt
add_executable(${TEST_NAME}_exec ${CMAKE_CURRENT_SOURCE_DIR}/compiler-out/${TEST_NAME}_cpp_program.cpp)
target_link_libraries(${TEST_NAME}_exec
  PRIVATE
  prelude)

# executable for the test driver
add_executable(${TEST_NAME}_test driver.cpp)
target_include_directories(${TEST_NAME}_test PUBLIC ${main_dir} ${testing_dir})
target_link_libraries(${TEST_NAME}_test 
  PRIVATE
  GTest::GTest
  prelude
  testing)

# adds a test to be tracked by the cmake
add_test(${TEST_NAME}_test ${TEST_NAME}_test)